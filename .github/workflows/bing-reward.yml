name: Bing Reward 定时执行

on:
  schedule:
    - cron: '0 0 * * *'  # 北京时间8点执行（UTC 0点）
  workflow_dispatch:

jobs:
  run-bing-reward:
    runs-on: ubuntu-22.04
    permissions:
      contents: read

    steps:
      - name: 检出仓库代码
        uses: actions/checkout@v4

      # 删除「进入 Bing 奖励脚本目录」这一步（多余且报错）
      - name: 创建并切换到 /app/bing-reward 目录
        run: |
          sudo mkdir -p /app/bing-reward  # 创建目录（需 sudo）
          sudo cp -r ./* /app/bing-reward/  # 复制所有脚本到该目录
          cd /app/bing-reward  # 切换到该目录
          ls -la  # 验证文件是否复制成功
      
      - name: 安装环境依赖
        run: |
          cd /app/bing-reward
          sed -i 's/\r$//' setup_ubuntu.sh
          chmod +x setup_ubuntu.sh
          sudo ./setup_ubuntu.sh

      - name: 运行 Bing 奖励脚本
        run: |
          cd /app/bing-reward
          sed -i 's/\r$//' start_bing_reward.sh
          chmod +x start_bing_reward.sh
          ./start_bing_reward.sh

      # 可选：保存日志（若脚本有日志文件，按实际路径调整）
      - name: 保存运行日志
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: bing-reward-logs
          path: |
            ./*log*  # 根目录下的所有日志文件
            /tmp/*   # 临时目录日志（如有）
